{"version":3,"sources":["../../../widgets/IMDC/Widget.js"],"names":["define","declare","on","has","query","lang","array","html","Color","domConstruct","_WidgetsInTemplateMixin","BaseWidget","TabContainer","Popup","Point","Graphic","esriConfig","Circle","Extent","Polyline","Multipoint","geometryEngine","graphicsUtils","SimpleFillSymbol","SimpleLineSymbol","SimpleMarkerSymbol","PictureMarkerSymbol","Query","QueryTask","Geoprocessor","GraphicsLayer","FeatureLayer","geometryJsonUtils","RelationParameters","Select","CheckBox","TextBox","NumberTextBox","ProgressBar","TableContainer","Chart","Default","Lines","Tooltip","easing","MouseIndicator","Highlight","Magnify","ChartLegend","RangeSlider","HorizontalRuleLabels","HorizontalRule","SpatialReference","GeometryService","ProjectParameters","ReachSelector","StatisticDefinition","baseClass","name","geometryService","routeLayer","feederFeatureLayer","csvToLinesGPTool","postCreate","inherited","arguments","_initSelect","_initRouteLayer","own","btnCalculate","hitch","_onCalculateButton","_findLayerByURL","config","feeder_layer","url","appConfig","console","error","log","startup","onOpen","onClose","_getHightLightMarkerSymbol","pType","style","STYLE_CIRCLE","size","color","a","outlineSymbol","outlineColor","outlineWidth","setStyle","STYLE_SOLID","setColor","setWidth","symbol","map","addLayer","fn","feeder_names","queryTask","q","returnGeometry","outFields","ffcode_field","name_display_field","where","orderByFields","execute","_onInitQueryComplete","_onInitQueryError","response","featureSet","features","length","options","label","value","ffcodeLookup","i","attributes","s_label","s_value","push","selectDropDown","set","_selectionChange","evt","minMaxInfoArea","innerHTML","outStatistics","info","statisticDefinition","statisticType","onStatisticField","outStatisticFieldName","then","res","STATION1MIN","STATION2MAX","formatStation","bind","err","_clear","setErrorMessage","feederName","get","reachNumber","reachInput","stationNumber","stationInput","replace","isNaN","window","alert","routeReach","route_layer","display_field","_onRouteQueryComplete","_onRouteQueryError","_onRouteQueryCompleteMultiple","startVertex","endVertex","bFound","spReference","newpoint","geometry","paths","dist","distance","matchedFeeder","matchedFeederObjectId","feederLinePaths","pathLength","vertices","verticesLength","j","_interpolatePoint","parseFloat","foundPoints","fi","station1","station2","attr","RouteReach","newGraphic","_interpolateMultiplePoints","_projectMultiple","startPoint","endPoint","station","x","y","point","_pointFromCoordsBtnClick","wkid","_projectPoint","message","errorSection","opLayers","itemInfo","itemData","operationalLayers","layerObject","clear","msgSection","wkidIn","wkidOut","xelement","yelement","params","spReferenceIn","spReferenceOut","geog","geometries","outSR","_this","project","centerAt","g","highlightMeasure","add","points","pointsToProject","setGeometry","extent","graphicsExtent","setExtent","reachSelector","destroy","graphics","layer","placeAt","multiplePointsControl","reachChosen","e","splice","string","start","delCount","newSubStr","slice","Math","abs","inNumber","twoDecimalNumber","round","toFixed","text","toString","pad","substring","rightSideIndex","indexOf","retValue"],"mappings":"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","file":"Widget.js","sourcesContent":["define([\r\n  \"dojo/_base/declare\",\r\n  \"dojo/on\",\r\n  \"dojo/has\",\r\n  \"dojo/query\",\r\n  \"dojo/_base/lang\",\r\n  \"dojo/_base/array\",\r\n  \"dojo/_base/html\",\r\n  \"dojo/_base/Color\",\r\n  \"dojo/dom-construct\",\r\n  \"dijit/_WidgetsInTemplateMixin\",\r\n  \"jimu/BaseWidget\",\r\n  \"jimu/dijit/TabContainer\",\r\n  \"jimu/dijit/Popup\",\r\n  \"esri/geometry/Point\",\r\n  \"esri/graphic\",\r\n  \"esri/config\",\r\n  \"esri/geometry/Circle\",\r\n  \"esri/geometry/Extent\",\r\n  \"esri/geometry/Polyline\",\r\n  \"esri/geometry/Multipoint\",\r\n  \"esri/geometry/geometryEngine\",\r\n  \"esri/graphicsUtils\",\r\n  \"esri/symbols/SimpleFillSymbol\",\r\n  \"esri/symbols/SimpleLineSymbol\",\r\n  \"esri/symbols/SimpleMarkerSymbol\",\r\n  \"esri/symbols/PictureMarkerSymbol\",\r\n  \"esri/tasks/query\",\r\n  \"esri/tasks/QueryTask\",\r\n  \"esri/tasks/Geoprocessor\",\r\n  \"esri/layers/GraphicsLayer\",\r\n  \"esri/layers/FeatureLayer\",\r\n  \"esri/geometry/jsonUtils\",\r\n  \"esri/tasks/RelationParameters\",\r\n  \"dijit/form/Select\",\r\n  \"dijit/form/CheckBox\",\r\n  \"dijit/form/TextBox\",\r\n  \"dijit/form/NumberTextBox\",\r\n  \"dijit/ProgressBar\",\r\n  \"dojox/layout/TableContainer\",\r\n  \"dojox/charting/Chart\",\r\n  \"dojox/charting/axis2d/Default\",\r\n  \"dojox/charting/plot2d/Lines\",\r\n  \"dojox/charting/action2d/Tooltip\",\r\n  \"dojo/fx/easing\",\r\n  \"dojox/charting/action2d/MouseIndicator\",\r\n  \"dojox/charting/action2d/Highlight\",\r\n  \"dojox/charting/action2d/Magnify\",\r\n  \"dojox/charting/widget/Legend\",\r\n  \"dojox/form/RangeSlider\",\r\n  \"dijit/form/HorizontalRuleLabels\",\r\n  \"dijit/form/HorizontalRule\",\r\n  \"esri/SpatialReference\",\r\n  \"esri/tasks/GeometryService\",\r\n  \"esri/tasks/ProjectParameters\",\r\n  \"./widgets/ReachSelector\",\r\n  \"esri/tasks/StatisticDefinition\"\r\n], function(\r\n  declare,\r\n  on,\r\n  has,\r\n  query,\r\n  lang,\r\n  array,\r\n  html,\r\n  Color,\r\n  domConstruct,\r\n  _WidgetsInTemplateMixin,\r\n  BaseWidget,\r\n  TabContainer,\r\n  Popup,\r\n  Point,\r\n  Graphic,\r\n  esriConfig,\r\n  Circle,\r\n  Extent,\r\n  Polyline,\r\n  Multipoint,\r\n  geometryEngine,\r\n  graphicsUtils,\r\n  SimpleFillSymbol,\r\n  SimpleLineSymbol,\r\n  SimpleMarkerSymbol,\r\n  PictureMarkerSymbol,\r\n  Query,\r\n  QueryTask,\r\n  Geoprocessor,\r\n  GraphicsLayer,\r\n  FeatureLayer,\r\n  geometryJsonUtils,\r\n  RelationParameters,\r\n  Select,\r\n  CheckBox,\r\n  TextBox,\r\n  NumberTextBox,\r\n  ProgressBar,\r\n  TableContainer,\r\n  Chart,\r\n  Default,\r\n  Lines,\r\n  Tooltip,\r\n  easing,\r\n  MouseIndicator,\r\n  Highlight,\r\n  Magnify,\r\n  ChartLegend,\r\n  RangeSlider,\r\n  HorizontalRuleLabels,\r\n  HorizontalRule,\r\n  SpatialReference,\r\n  GeometryService,\r\n  ProjectParameters,\r\n  ReachSelector,\r\n  StatisticDefinition\r\n) {\r\n  //To create a widget, you need to derive from BaseWidget.\r\n  return declare([BaseWidget, _WidgetsInTemplateMixin], {\r\n    // Custom widget code goes here\r\n\r\n    baseClass: \"jimu-widget-imdc\",\r\n\r\n    //this property is set by the framework when widget is loaded.\r\n    name: \"IMDC\",\r\n    //config: require('./config.json'),\r\n\r\n    //methods to communication with app container:\r\n    geometryService: null,\r\n    routeLayer: null,\r\n    feederFeatureLayer: null,\r\n    csvToLinesGPTool: null,\r\n\r\n    //everything that fires after the widget is created goes in this postcreate function\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      this._initSelect();\r\n      this._initRouteLayer();\r\n      this.own(\r\n        on(\r\n          this.btnCalculate,\r\n          \"click\",\r\n          lang.hitch(this, this._onCalculateButton)\r\n        )\r\n      );\r\n      this.feederFeatureLayer = this._findLayerByURL(\r\n        this.config.feeder_layer.url\r\n      );\r\n      this.geometryService = new GeometryService(\r\n        this.appConfig.geometryService\r\n      );\r\n      if (!this.feederFeatureLayer) {\r\n        console.error(\r\n          \"Could not find Feature Layer! Double-check your URLs in the web map vs the config.\"\r\n        );\r\n      }\r\n      console.log(\"postCreate\");\r\n    },\r\n\r\n    startup: function() {\r\n      this.inherited(arguments);\r\n      console.log(\"startup\");\r\n    },\r\n\r\n    onOpen: function() {\r\n      console.log(\"onOpen\");\r\n    },\r\n\r\n    onClose: function() {\r\n      console.log(\"onClose\");\r\n    },\r\n\r\n    //creates the marker symbol used to render results on a map\r\n    _getHightLightMarkerSymbol: function(pType) {\r\n      var style = SimpleMarkerSymbol.STYLE_CIRCLE;\r\n      var size = 15;\r\n      var color =\r\n        pType == 0\r\n          ? new Color(\"#3fafdc\")\r\n          : pType == 1\r\n          ? new Color(\"#0000ff\")\r\n          : new Color(\"#00ff00\");\r\n      color.a = 1;\r\n\r\n      var outlineSymbol = new SimpleLineSymbol();\r\n      var outlineColor = \"#ff0000\";\r\n      var outlineWidth = 3;\r\n      outlineSymbol.setStyle(SimpleLineSymbol.STYLE_SOLID);\r\n      outlineSymbol.setColor(outlineColor);\r\n      outlineSymbol.setWidth(outlineWidth);\r\n\r\n      var symbol = new SimpleMarkerSymbol(style, size, outlineSymbol, color);\r\n      return symbol;\r\n    },\r\n    //creates the empty route layer and adds it to the map\r\n    _initRouteLayer: function() {\r\n      this.routeLayer = new GraphicsLayer();\r\n      this.map.addLayer(this.routeLayer);\r\n    },\r\n    //creates the select task that reads the feeder names from the feature service\r\n    _initSelect: function() {\r\n      var fn = this.config.feeder_names;\r\n      var queryTask = new QueryTask(fn.url + \"?returnDistinctValues=true\");\r\n      var q = new Query();\r\n      q.returnGeometry = false;\r\n      q.outFields = [fn.ffcode_field, fn.name_display_field];\r\n      q.where = \"1=1\";\r\n      q.orderByFields = [fn.name_display_field];\r\n      queryTask.execute(q);\r\n      this.own(\r\n        on(queryTask, \"complete\", lang.hitch(this, this._onInitQueryComplete))\r\n      );\r\n      this.own(\r\n        on(queryTask, \"error\", lang.hitch(this, this._onInitQueryError))\r\n      );\r\n    },\r\n    //takes the returns from the queryTask and populates the dropdown list\r\n    _onInitQueryComplete: function(response) {\r\n      //html.setStyle(this.progressBar.domNode, 'display', 'none');\r\n\r\n      console.log(\"_onInitQueryComplete\", response);\r\n      var featureSet = response.featureSet;\r\n      var features = featureSet.features;\r\n      var length = features.length;\r\n      var options = [\r\n        {\r\n          label: \"Select...\",\r\n          value: \"\"\r\n        }\r\n      ];\r\n      if (length > 0) {\r\n        this.ffcodeLookup = {};\r\n        for (var i = 0; i < length; i++) {\r\n          var attributes = features[i].attributes;\r\n          var s_label =\r\n            attributes[this.config.feeder_names.name_display_field] +\r\n            \" (\" +\r\n            attributes[this.config.feeder_names.ffcode_field] +\r\n            \")\";\r\n          var s_value = i+1;\r\n\r\n          // we are setting a unique ID as the value of the dropdown, because we cannot have duplicates\r\n          // so we have to have a lookup for when we need to get the ffcode from the objectid\r\n          this.ffcodeLookup[s_value] = attributes[this.config.feeder_names.ffcode_field];\r\n          options.push({\r\n            label: s_label,\r\n            value: s_value\r\n          });\r\n        }\r\n        this.selectDropDown.set(\"options\", options);\r\n        this.own(\r\n          on(\r\n            this.selectDropDown,\r\n            \"change\",\r\n            lang.hitch(this, this._selectionChange)\r\n          )\r\n        );\r\n        //this.own(on(this.zoomLevels, \"change\", lang.hitch(this, this._zoomLevelChange)));\r\n      }\r\n    },\r\n\r\n    _selectionChange: function(evt) {\r\n      console.log(\"selection change\", evt);\r\n      if (evt === \"\") {\r\n        this.minMaxInfoArea.innerHTML = \"\";\r\n      } else {\r\n        var queryTask = new QueryTask(this.config.feeder_layer.url + \"/query\");\r\n        var q = new Query();\r\n        q.returnGeometry = false;\r\n        q.where = \"FFCODE = '\" + this.ffcodeLookup[evt] + \"'\";\r\n        q.outStatistics = [\r\n          // ['max', 'STATION1', 'STATION1MAX'],\r\n          [\"min\", \"STATION1\", \"STATION1MIN\"],\r\n          [\"max\", \"STATION2\", \"STATION2MAX\"]\r\n          // ['min', 'STATION2', 'STATION2MIN'],\r\n        ].map(function(info) {\r\n          var statisticDefinition = new StatisticDefinition();\r\n          statisticDefinition.statisticType = info[0];\r\n          statisticDefinition.onStatisticField = info[1];\r\n          statisticDefinition.outStatisticFieldName = info[2];\r\n          return statisticDefinition;\r\n        });\r\n\r\n        queryTask.execute(q).then(\r\n          function(res) {\r\n            console.log(\"res\", res);\r\n            if (\r\n              res.features[0].attributes.STATION1MIN &&\r\n              res.features[0].attributes.STATION2MAX\r\n            ) {\r\n              this.minMaxInfoArea.innerHTML =\r\n                \"(Valid values: \" +\r\n                this.formatStation(res.features[0].attributes.STATION1MIN) +\r\n                \"-\" +\r\n                this.formatStation(res.features[0].attributes.STATION2MAX) +\r\n                \")\";\r\n            } else {\r\n              this.minMaxInfoArea.innerHTML = \"\";\r\n            }\r\n          }.bind(this),\r\n          function(err) {\r\n            console.log(\"err\", err);\r\n          }\r\n        );\r\n      }\r\n    },\r\n\r\n    _onInitQueryError: function(error) {\r\n      console.error(\"ProfileWidget query failed\", error);\r\n      //this._showError(\"Error\");\r\n    },\r\n    //fires off the IMDC calculation based on the given inputs\r\n    _onCalculateButton: function() {\r\n      this._clear();\r\n      this.setErrorMessage();\r\n      var feederName = this.ffcodeLookup[this.selectDropDown.get(\"value\")];\r\n      var reachNumber = this.reachInput.value;\r\n      var stationNumber = this.stationInput.value.replace('+', '');\r\n      if (isNaN(stationNumber)) {\r\n        window.alert(\r\n          \"Must provide a valid number in the station number input.\"\r\n        );\r\n        return;\r\n      }\r\n      //If the reach is provided, do this querytask:\r\n      if (reachNumber && !isNaN(reachNumber)) {\r\n        var routeReach = feederName + \"_\" + reachNumber;\r\n\r\n        var route_layer = this.config.route_layer;\r\n        var queryTask = new QueryTask(route_layer.url + \"?returnM=true\");\r\n        var q = new Query();\r\n        q.returnGeometry = true;\r\n        var outFields = [route_layer.display_field, \"OBJECTID\"];\r\n        q.outFields = outFields;\r\n        q.where =\r\n          this.config.route_layer.display_field + \"= '\" + routeReach + \"'\";\r\n        queryTask.execute(q);\r\n        this.own(\r\n          on(\r\n            queryTask,\r\n            \"complete\",\r\n            lang.hitch(this, this._onRouteQueryComplete)\r\n          )\r\n        );\r\n        this.own(\r\n          on(queryTask, \"error\", lang.hitch(this, this._onRouteQueryError))\r\n        );\r\n      }\r\n      //If the reach is not provided, do this querytask:\r\n      else {\r\n        var route_layer = this.config.route_layer;\r\n        var queryTask = new QueryTask(route_layer.url + \"?returnM=true\");\r\n        var q = new Query();\r\n        q.returnGeometry = true;\r\n        var outFields = [\r\n          route_layer.display_field,\r\n          \"OBJECTID\",\r\n          \"Station1\",\r\n          \"Station2\"\r\n        ];\r\n        q.outFields = outFields;\r\n        q.where =\r\n          this.config.route_layer.display_field + \" LIKE '\" + feederName + \"%'\";\r\n        queryTask.execute(q);\r\n        this.own(\r\n          on(\r\n            queryTask,\r\n            \"complete\",\r\n            lang.hitch(this, this._onRouteQueryCompleteMultiple)\r\n          )\r\n        );\r\n        this.own(\r\n          on(queryTask, \"error\", lang.hitch(this, this._onRouteQueryError))\r\n        );\r\n      }\r\n    },\r\n    //Fires when the query task is completed with a reach provided:\r\n    _onRouteQueryComplete: function(response) {\r\n      console.log(\"_onRouteQueryComplete\", response);\r\n      var featureSet = response.featureSet;\r\n      var features = featureSet.features;\r\n      var stationNumber = this.stationInput.value.replace('+', '');\r\n      var length = features.length;\r\n      var startVertex;\r\n      var endVertex;\r\n      var bFound = false;\r\n      if (length > 0) {\r\n        var spReference = new SpatialReference(2230);\r\n        var newpoint = new Point(\r\n          features[0].geometry.paths[0][0][0],\r\n          features[0].geometry.paths[0][0][1],\r\n          spReference\r\n        );\r\n        //console.log(features[0].geometry.paths[0][0][0] + \" \" + features[0].geometry.paths[0][0][1]);\r\n        var dist = geometryEngine.distance(\r\n          features[0].geometry,\r\n          newpoint,\r\n          9002\r\n        );\r\n        console.log(\"distance:\" + dist);\r\n\r\n        this.matchedFeeder = features[0].geometry;\r\n        this.matchedFeederObjectId = features[0].attributes[\"OBJECTID\"];\r\n\r\n        var feederLinePaths = features[0].geometry.paths;\r\n        var pathLength = feederLinePaths.length;\r\n\r\n        for (var i = 0; i < pathLength && bFound == false; i++) {\r\n          var vertices = feederLinePaths[i];\r\n          var verticesLength = vertices.length;\r\n          for (var j = 0; j < verticesLength && bFound == false; j++) {\r\n            if (vertices[j][2] > stationNumber) {\r\n              endVertex = vertices[j];\r\n              startVertex = vertices[j - 1];\r\n              bFound = true;\r\n            }\r\n          }\r\n        }\r\n        console.log(startVertex, endVertex);\r\n        this._interpolatePoint(startVertex, endVertex, stationNumber);\r\n      } else {\r\n        this.setErrorMessage(\"Could not find reach\");\r\n      }\r\n    },\r\n    //if the querytask completes with no reach given, do this:\r\n    _onRouteQueryCompleteMultiple: function(response) {\r\n      console.log(\"_onRouteQueryCompleteMultiple\", response);\r\n      var featureSet = response.featureSet;\r\n      var features = featureSet.features;\r\n      var stationNumber = parseFloat(this.stationInput.value.replace('+', ''));\r\n      var length = features.length;\r\n      var startVertex;\r\n      var endVertex;\r\n      //var foundCount = 0;\r\n      var foundPoints = [];\r\n      if (length > 0) {\r\n        for (var fi = 0; fi < length; fi++) {\r\n          var spReference = new SpatialReference(2230);\r\n          var newpoint = new Point(\r\n            features[fi].geometry.paths[0][0][0],\r\n            features[fi].geometry.paths[0][0][1],\r\n            spReference\r\n          );\r\n          var dist = geometryEngine.distance(\r\n            features[fi].geometry,\r\n            newpoint,\r\n            9002\r\n          );\r\n          console.log(\"distance:\" + dist);\r\n          this.matchedFeeder = features[fi].geometry;\r\n          this.matchedFeederObjectId = features[fi].attributes[\"OBJECTID\"];\r\n          this.station1 = features[fi].attributes[\"STATION1\"];\r\n          this.station2 = features[fi].attributes[\"STATION2\"];\r\n          var feederLinePaths = features[fi].geometry.paths;\r\n          var pathLength = feederLinePaths.length;\r\n          if (stationNumber >= this.station1 && stationNumber <= this.station2) {\r\n            var bFound = false;\r\n            for (var i = 0; i < pathLength; i++) {\r\n              var vertices = feederLinePaths[i];\r\n              var verticesLength = vertices.length;\r\n              for (var j = 0; j < verticesLength; j++) {\r\n                if (vertices[j][2] >= stationNumber && bFound == false) {\r\n                  endVertex = vertices[j];\r\n                  startVertex = vertices[j - 1];\r\n                  bFound = true;\r\n                  //foundCount++;\r\n                  var attr = {\r\n                    RouteReach: features[fi].attributes[\"ROUTEREACH\"]\r\n                  };\r\n                  var newGraphic = new Graphic(\r\n                    this._interpolateMultiplePoints(\r\n                      startVertex,\r\n                      endVertex,\r\n                      stationNumber\r\n                    ),\r\n                    this._getHightLightMarkerSymbol(0),\r\n                    attr\r\n                  );\r\n                  //foundPoints.push(this._interpolateMultiplePoints(startVertex, endVertex, stationNumber));\r\n                  foundPoints.push(newGraphic);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (foundPoints.length > 1) {\r\n          this._projectMultiple(foundPoints);\r\n        } else {\r\n          this._interpolatePoint(startVertex, endVertex, stationNumber);\r\n        }\r\n      } else {\r\n        this.setErrorMessage(\"Could not find reach\");\r\n      }\r\n    },\r\n\r\n    _interpolateMultiplePoints: function(startPoint, endPoint, station) {\r\n      var x;\r\n      var y;\r\n\r\n      x =\r\n        startPoint[0] +\r\n        ((endPoint[0] - startPoint[0]) * (station - startPoint[2])) /\r\n          (endPoint[2] - startPoint[2]);\r\n      y =\r\n        startPoint[1] +\r\n        ((endPoint[1] - startPoint[1]) * (station - startPoint[2])) /\r\n          (endPoint[2] - startPoint[2]);\r\n\r\n      var point = new Point(x, y, new SpatialReference(2230));\r\n      return point;\r\n      //return [x, y];\r\n    },\r\n\r\n    _onRouteQueryError: function(error) {\r\n      console.log(error);\r\n    },\r\n    //perform the linear interpolation on the segment containing the station, to determine where to place the point\r\n    _interpolatePoint: function(startPoint, endPoint, station) {\r\n      this.setErrorMessage(\"\");\r\n      if (!startPoint || !endPoint) {\r\n        console.error(\r\n          \"Error - start and end points are not set going into _interpolatePoint\"\r\n        );\r\n        if(this.reachInput.value !== '') {\r\n          this.setErrorMessage(\"Could not find reach\");\r\n        } else {\r\n          this.setErrorMessage(\"Invalid station for this feeder\");\r\n        }\r\n      } else {\r\n        var x;\r\n        var y;\r\n\r\n        x =\r\n          startPoint[0] +\r\n          ((endPoint[0] - startPoint[0]) * (station - startPoint[2])) /\r\n            (endPoint[2] - startPoint[2]);\r\n        y =\r\n          startPoint[1] +\r\n          ((endPoint[1] - startPoint[1]) * (station - startPoint[2])) /\r\n            (endPoint[2] - startPoint[2]);\r\n\r\n        this._pointFromCoordsBtnClick(2230, x, y);\r\n      }\r\n    },\r\n    //create point from values in the coordinate boxes\r\n    _pointFromCoordsBtnClick: function(wkid, x, y) {\r\n      //console.log(wkid);\r\n      //console.log(xelement);\r\n      //console.log(yelement);\r\n\r\n      if (isNaN(x) || isNaN(y)) {\r\n        window.alert(\"The coordinate values must both be numbers.\");\r\n        return;\r\n      }\r\n\r\n      this._projectPoint(wkid, 102100, x, y, null, null);\r\n    },\r\n\r\n    setErrorMessage: function(message) {\r\n      if (message) {\r\n        this.errorSection.innerHTML = message;\r\n      } else {\r\n        this.errorSection.innerHTML = \"\";\r\n      }\r\n    },\r\n\r\n    _findLayerByURL: function(url) {\r\n      var opLayers = this.map.itemInfo.itemData.operationalLayers;\r\n      for (var i = 0; i < opLayers.length; i++) {\r\n        if (opLayers[i].layerObject.url == this.config.feeder_layer.url) {\r\n          return opLayers[i].layerObject;\r\n        }\r\n      }\r\n      //return null;\r\n    },\r\n\r\n    _clear: function() {\r\n      this.routeLayer.clear();\r\n      this.msgSection.innerHTML = \"\";\r\n    },\r\n    //create the proper coordinates for the multiple projections\r\n    _projectPoint: function(wkidIn, wkidOut, x, y, xelement, yelement) {\r\n      var params = new ProjectParameters();\r\n      var spReferenceIn = new SpatialReference(wkidIn);\r\n      var spReferenceOut = new SpatialReference(wkidOut);\r\n      var geog = new Point(x, y, spReferenceIn);\r\n      params.geometries = [geog];\r\n      params.outSR = spReferenceOut;\r\n      _this = this;\r\n      if (wkidOut == 102100) {\r\n        _this.routeLayer.clear();\r\n      }\r\n\r\n      this.geometryService.project(params).then(function(response) {\r\n        if (xelement != null) {\r\n          //    xelement.set(\"value\", response[0].x);\r\n          //    yelement.set(\"value\", response[0].y);\r\n          //    if (wkidOut == 4326) {\r\n          //        _this._convertDDToDMS(response[0].x, _this.dmsLonInput);\r\n          //        _this._convertDDToDMS(response[0].y, _this.dmsLatInput);\r\n          //    }\r\n        } else {\r\n          _this.map.centerAt(response[0]);\r\n          var g = new Graphic(\r\n            response[0],\r\n            _this._getHightLightMarkerSymbol(0),\r\n            {\r\n              highlightMeasure: true\r\n            }\r\n          );\r\n          //    _this._findOffsetAngleDistance(response[0]);\r\n          _this.routeLayer.add(g);\r\n        }\r\n      });\r\n    },\r\n\r\n    _projectMultiple: function(points) {\r\n      var pointsToProject = [];\r\n      this.routeLayer.clear();\r\n      for (var i = 0; i < points.length; i++) {\r\n        pointsToProject.push(points[i].geometry);\r\n      }\r\n\r\n      var params = new ProjectParameters();\r\n      params.geometries = pointsToProject;\r\n      params.outSR = new SpatialReference(102100);\r\n      try {\r\n        this.geometryService.project(params).then(\r\n          lang.hitch(this, function(response) {\r\n            for (var i = 0; i < points.length; i++) {\r\n              points[i].setGeometry(response[i]);\r\n              this.routeLayer.add(points[i]);\r\n            }\r\n\r\n            var extent = graphicsUtils.graphicsExtent(points);\r\n            this.map.setExtent(extent);\r\n            // this.map.centerAt(extent.getCenter());\r\n\r\n            if (this.reachSelector) {\r\n              this.reachSelector.destroy();\r\n              this.reachSelector = null;\r\n            }\r\n            this.reachSelector = new ReachSelector({\r\n              graphics: points,\r\n              layer: this.routeLayer,\r\n              map: this.map\r\n            });\r\n            this.reachSelector.placeAt(this.multiplePointsControl, \"last\");\r\n\r\n            this.reachSelector.on(\r\n              \"reachChosen\",\r\n              function(reachChosen) {\r\n                this.reachInput.value = reachChosen;\r\n                this._onCalculateButton();\r\n                this.reachSelector.destroy();\r\n                this.reachSelector = false;\r\n              }.bind(this)\r\n            );\r\n          })\r\n        );\r\n      } catch (e) {\r\n        console.log(\"There was an error with the multiple project:\", e);\r\n      }\r\n    },\r\n\r\n    splice: function(string, start, delCount, newSubStr) {\r\n      return (\r\n        string.slice(0, start) +\r\n        newSubStr +\r\n        string.slice(start + Math.abs(delCount))\r\n      );\r\n    },\r\n\r\n    formatStation: function(inNumber) {\r\n      var twoDecimalNumber = parseFloat(Math.round(inNumber * 100) / 100).toFixed(2);\r\n      var text = twoDecimalNumber.toString();\r\n      console.log(\"formatStation1\", text);\r\n\r\n      // make sure the number (string) has at least three digits to the left of the period:\r\n      var pad = \"000000\"\r\n      var text = pad.substring(0, pad.length - text.length) + text\r\n      console.log(\"formatStation2\", text);\r\n\r\n      var rightSideIndex =\r\n        text.indexOf(\".\") > -1 ? text.indexOf(\".\") : text.length;\r\n\r\n      console.log(\"rightSideIndex\", rightSideIndex);\r\n      console.log(\"leftSideIndex\", rightSideIndex);\r\n\r\n      var retValue = this.splice(text, rightSideIndex - 2, 0, \"+\");\r\n      console.log('returning:', retValue);\r\n      return retValue;\r\n    }\r\n  });\r\n});\r\n"]}